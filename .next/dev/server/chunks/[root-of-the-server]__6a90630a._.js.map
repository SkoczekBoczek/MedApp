{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/nikodemwitkowski/Desktop/WEBSITE/MedApp/app/api/plan/route.js"],"sourcesContent":["import { MongoClient } from \"mongodb\";\n\nlet cachedClient = null;\nlet cachedDb = null;\n\nasync function connectToDatabase() {\n\tif (cachedClient && cachedDb) return { client: cachedClient, db: cachedDb };\n\n\tconst client = await MongoClient.connect(process.env.MONGODB_URI);\n\tconst db = client.db(\"clinicDB\");\n\tcachedClient = client;\n\tcachedDb = db;\n\n\treturn { client, db };\n}\n\nexport async function GET(req) {\n\ttry {\n\t\tconst { db } = await connectToDatabase();\n\t\tconst { searchParams } = new URL(req.url);\n\t\tconst userToken = searchParams.get(\"token\");\n\t\tconst plan = await db.collection(\"plans\").findOne({ userToken });\n\n\t\tif (!plan) {\n\t\t\treturn new Response(JSON.stringify({ error: \"Plan not found\" }), {\n\t\t\t\tstatus: 404,\n\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t});\n\t\t}\n\n\t\treturn new Response(JSON.stringify(plan), {\n\t\t\tstatus: 200,\n\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t});\n\t} catch (error) {\n\t\treturn new Response(JSON.stringify({ error: \"Internal Server Error\" }), {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t});\n\t}\n}\n\nexport async function POST(req) {\n\ttry {\n\t\tconst { db } = await connectToDatabase();\n\t\tconst plan = await req.json();\n\n\t\tconst existingPlan = await db\n\t\t\t.collection(\"plans\")\n\t\t\t.findOne({ userToken: plan.userToken });\n\n\t\tif (existingPlan) {\n\t\t\tawait db\n\t\t\t\t.collection(\"plans\")\n\t\t\t\t.updateOne(\n\t\t\t\t\t{ userToken: plan.userToken },\n\t\t\t\t\t{ $set: { weeklyPlan: plan.plan } }\n\t\t\t\t);\n\n\t\t\treturn new Response(\n\t\t\t\tJSON.stringify({ message: \"Plan updated successfully\" }),\n\t\t\t\t{\n\t\t\t\t\tstatus: 200,\n\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tawait db.collection(\"plans\").insertOne({\n\t\t\t\tuserToken: plan.userToken,\n\t\t\t\tweeklyPlan: plan.plan,\n\t\t\t});\n\t\t\treturn new Response(\n\t\t\t\tJSON.stringify({ message: \"Plan created successfully\" }),\n\t\t\t\t{\n\t\t\t\t\tstatus: 201,\n\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t} catch (error) {\n\t\treturn new Response(JSON.stringify({ error: \"Internal Server Error\" }), {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t});\n\t}\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,eAAe;AACnB,IAAI,WAAW;AAEf,eAAe;IACd,IAAI,gBAAgB,UAAU,OAAO;QAAE,QAAQ;QAAc,IAAI;IAAS;IAE1E,MAAM,SAAS,MAAM,sHAAW,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,WAAW;IAChE,MAAM,KAAK,OAAO,EAAE,CAAC;IACrB,eAAe;IACf,WAAW;IAEX,OAAO;QAAE;QAAQ;IAAG;AACrB;AAEO,eAAe,IAAI,GAAG;IAC5B,IAAI;QACH,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,OAAO,MAAM,GAAG,UAAU,CAAC,SAAS,OAAO,CAAC;YAAE;QAAU;QAE9D,IAAI,CAAC,MAAM;YACV,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAiB,IAAI;gBAChE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAC/C;QACD;QAEA,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC,OAAO;YACzC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAC/C;IACD,EAAE,OAAO,OAAO;QACf,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAwB,IAAI;YACvE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAC/C;IACD;AACD;AAEO,eAAe,KAAK,GAAG;IAC7B,IAAI;QACH,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,MAAM,eAAe,MAAM,GACzB,UAAU,CAAC,SACX,OAAO,CAAC;YAAE,WAAW,KAAK,SAAS;QAAC;QAEtC,IAAI,cAAc;YACjB,MAAM,GACJ,UAAU,CAAC,SACX,SAAS,CACT;gBAAE,WAAW,KAAK,SAAS;YAAC,GAC5B;gBAAE,MAAM;oBAAE,YAAY,KAAK,IAAI;gBAAC;YAAE;YAGpC,OAAO,IAAI,SACV,KAAK,SAAS,CAAC;gBAAE,SAAS;YAA4B,IACtD;gBACC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAC/C;QAEF,OAAO;YACN,MAAM,GAAG,UAAU,CAAC,SAAS,SAAS,CAAC;gBACtC,WAAW,KAAK,SAAS;gBACzB,YAAY,KAAK,IAAI;YACtB;YACA,OAAO,IAAI,SACV,KAAK,SAAS,CAAC;gBAAE,SAAS;YAA4B,IACtD;gBACC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAC/C;QAEF;IACD,EAAE,OAAO,OAAO;QACf,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,OAAO;QAAwB,IAAI;YACvE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAC/C;IACD;AACD","debugId":null}}]
}